<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <script src="/webjars/jquery/3.6.3/dist/jquery.min.js"></script>
    <script src="/webjars/bootstrap/5.2.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/webjars/bootstrap/5.2.3/css/bootstrap.min.css"/>
    <title>University Schedule Web App - Admin Page</title>
</head>
<body>



<header th:insert="blocks/header :: header"></header>

<div class="container mt-3">
    <h3 class="text-center">Course</h3>

    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#add">
        Add course
    </button>

    <div class="modal" id="add">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Modal Heading</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body modal-lg">
                    <form th:action="@{/admin/courses/save}" method="post">
                        <label>Course Name
                            <input name="courseName" type="text" class="form-control">
                        </label>
                        <label>Description
                            <input name="description" type="text" class="form-control">
                        </label>
                        <label> Teacher
                            <select class="form-select" name="teacherId">
                                <option th:each="teacher : ${allTeachers}"
                                        th:value="${teacher.userId}"
                                        th:text="${teacher.firstName} + ' ' + ${teacher.lastName}">
                                </option>
                            </select>
                        </label>
<!--                        <label>Students-->
<!--                            <div id="row" th:each="st: ${course.students}">-->
<!--                                <div class="input-group m-3">-->
<!--                                    <div class="input-group m-3">-->
<!--                                        <select name="student" class="btn-light mr-0">-->
<!--                                            <option th:each="student: ${allStudents}"-->
<!--                                                    th:value="${student.userId}"-->
<!--                                                    th:selected="${st.userId == student.userId}"-->
<!--                                                    th:text="${student.firstName} + ' ' + ${student.lastName}">-->
<!--                                            </option>-->
<!--                                        </select>-->
<!--                                        <button class="btn btn-danger" id="DeleteRow" type="button">-->
<!--                                            <i class="bi bi-x"></i></button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div id="newinput"></div>-->
<!--                            <button id="rowAdder" type="button"-->
<!--                                    class="btn btn-outline-dark">-->
<!--                                ADD-->
<!--                            </button>-->
<!--                        </label>-->
                        <button type="submit" class="btn btn-dark">Save</button>
                    </form>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>



    <table class="table">
        <thead class="thead-dark">
        <tr>
            <th scope="col">#</th>
            <th scope="col">Course Name</th>
            <th scope="col">Description</th>
            <th scope="col">Teacher</th>
            <th scope="col" class="text-center">Students</th>
            <th scope="col">Edit</th>
            <th scope="col">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="course, iter : ${courses}">
            <th th:text="${course.courseId}"/>
            <td th:text="${course.courseName}"/>
            <td th:text="${course.description}"/>
            <td th:text="${course.teacher.firstName} + ' ' + ${course.teacher.lastName}"/>
            <td>
           <span th:each="student, iterStat : ${course.getStudents()}">
          <span th:text="${student.firstName} + ' ' + ${student.lastName}"></span>
          <span th:if="!${iterStat.last}">, </span>
               </span>
            </td>
            <td>
                <button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
                        th:data-bs-target="'#modal' + ${course.courseId}">Edit
                </button>
                <div class="modal" th:id="'modal' + ${course?.courseId}">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Modal Heading</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body modal-lg">
                                <form th:action="@{/admin/courses/save}" method="post">
                                    <label> ID
                                        <input name="courseId" type="number" class="form-control"
                                               th:value="${course.courseId}" th:disabled="${course.courseId != null}">
                                    </label>
                                    <label>Course Name
                                        <input name="courseName" type="text" class="form-control"
                                               th:value="${course.courseName}">
                                    </label>
                                    <label>Description
                                        <input name="description" type="text" class="form-control"
                                               th:value="${course.description}">
                                    </label>
                                    <label> Teacher
                                        <select class="form-select" name="teacher">
                                            <option th:each="teacher : ${allTeachers}"
                                                    th:value="${teacher.userId}"
                                                    th:text="${teacher.firstName} + ' ' + ${teacher.lastName}"
                                                    th:selected="${teacher.userId == course.teacher.userId}">Day
                                            </option>
                                        </select>
                                    </label>
                                    <label>Students
                                        <div id="row" th:each="st: ${course.students}">
                                            <div class="input-group m-3">
                                                <div class="input-group m-3">
                                                    <select name="student" class="btn-light mr-0">
                                                        <option th:each="student: ${allStudents}"
                                                                th:value="${student.userId}"
                                                                th:selected="${st.userId == student.userId}"
                                                                th:text="${student.firstName} + ' ' + ${student.lastName}">
                                                        </option>
                                                    </select>
                                                    <button class="btn btn-danger" id="DeleteRow" type="button">
                                                        <i class="bi bi-x"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="newinput"></div>
                                        <button id="rowAdder" type="button"
                                                class="btn btn-outline-dark">
                                            ADD
                                        </button>
                                    </label>
                                    <button type="submit" class="btn btn-dark">Save</button>
                                </form>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                            </div>

                        </div>
                    </div>
                </div>
            </td>
            <td>
                <form th:action="@{/admin/courses/delete}" method="post">
                    <button type="submit" class="btn btn-danger" name="deleteCourseId"
                            th:value="${course.courseId}">
                        Delete
                    </button>
                </form>
            </td>


        </tr>
        </tbody>
    </table>




    <script th:inline="javascript" type="text/javascript">
        $("#rowAdder").click(function () {
            newRowAdd =
                '<div id="row">'+
                '<div class="input-group m-3">'+
                '<div class="input-group m-3">'+
                '<select name="student" class="btn-light mr-0">'+
                '<option th:each="student: ${allStudents}" th:value="${student.userId}" th:selected="${course.students.contains(student)}" th:text="${student.firstName student.lastName}">'+
                '</option>'+
                '</select>'+
                '<button class="btn btn-danger" id="DeleteRow" type="button">'+
                '<i class="bi bi-x"></i></button>'+
                '</div>'+
                '</div>'+
                '</div>';
            $('#newinput').append(newRowAdd);
        });

        $("body").on("click", "#DeleteRow", function () {
            $(this).parents("#row").remove();
        })
    </script>
</div>
</body>
</html>



